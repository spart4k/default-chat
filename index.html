<html>
 <head>
  <meta charset="utf-8">
  <title>Chat CRM</title>
 </head>
 <body>
  <div class="body">
    <div class="leftbar">

    </div>
    <div class="chat" id="chat">
      <div class="wrap">
        <div class="chat-contacts">
          <div class="chat-contacts__search">
            <div class="search">
              <input v-model="chat.searchField" placeholder="Поиск" type="text">
              <div v-if="chat.searchField" @click="clearSearch" class="search-close">
                <svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M14.1562 1.41L12.7463 0L7.15625 5.59L1.56625 0L0.15625 1.41L5.74625 7L0.15625 12.59L1.56625 14L7.15625 8.41L12.7463 14L14.1562 12.59L8.56625 7L14.1562 1.41Z" fill="black"/>
                </svg>
              </div>
            </div>
          </div>
          <div class="chat-contacts-wrap">
            <div v-if="searchedContacts.length" class="chat-contacts-list">
              <div v-for="(item) in searchedContacts" :class="item.active ? 'active' : ''" @click="openDialog(item)" class="chat-contacts-list__dialog contact">
                <div class="contact-avatar">
                  <img :src="item.avatar" alt="">
                </div>
                <div class="contact-info">
                  <div class="contact-title" :class="item.active ? 'active' : ''">
                    {{ item.title }}
                  </div>
                  <div class="">

                  </div>
                  <div class="contact-message clip" :class="item.active ? 'active' : ''">
                    <!-- {{ item.messages[item.messages.length - 1].text }} -->
                    <transition name="slide-fade" mode="out-in">
                      <div :key="getLastMessage(item).id" class="contact-message__text clip" :class="item.active ? 'active' : ''">
                        {{ getLastMessage(item).text ? getLastMessage(item).text : `Вложения: ${getLastMessage(item).attachment.files.length} ` }}
                      </div>
                    </transition>
                    <!--<div class="contact-message__text clip" :class="item.active ? 'active' : ''">
                      {{ getLastMessage(item).text }}
                    </div>-->
                      <div v-if="isYourselfMessage(getLastMessage(item))" :class="getLastMessage(item).checked ? 'checked' : ''" class="contact-message__state">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">
                          <defs>
                          </defs>
                          <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                            <path d="M 89.122 3.486 L 89.122 3.486 c -2.222 -3.736 -7.485 -4.118 -10.224 -0.742 L 33.202 59.083 c -1.118 1.378 -3.245 1.303 -4.262 -0.151 L 17.987 43.291 c -3.726 -5.322 -11.485 -5.665 -15.666 -0.693 l 0 0 c -2.883 3.428 -3.102 8.366 -0.533 12.036 L 24.206 86.65 c 2.729 3.897 8.503 3.89 11.222 -0.014 l 6.435 -9.239 L 88.87 10.265 C 90.28 8.251 90.378 5.598 89.122 3.486 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: currentColor; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                          </g>
                        </svg>
                        <svg class="second" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">
                          <defs>
                          </defs>
                          <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                            <path d="M 89.122 3.486 L 89.122 3.486 c -2.222 -3.736 -7.485 -4.118 -10.224 -0.742 L 33.202 59.083 c -1.118 1.378 -3.245 1.303 -4.262 -0.151 L 17.987 43.291 c -3.726 -5.322 -11.485 -5.665 -15.666 -0.693 l 0 0 c -2.883 3.428 -3.102 8.366 -0.533 12.036 L 24.206 86.65 c 2.729 3.897 8.503 3.89 11.222 -0.014 l 6.435 -9.239 L 88.87 10.265 C 90.28 8.251 90.378 5.598 89.122 3.486 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: currentColor; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                          </g>
                        </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div v-else class="chat-contacts__notfound">
              Ничего не найдено
            </div>
          </div>

        </div>
        <div class="chat-dialog">
          <div v-if="activeDialog" class="chat-dialog-wrap">
            <div class="chat-dialog-header">
              <div class="chat-dialog-header-wrap">
                <transition tag="div" :name="transitionDialogHeader">
                  <div key='1' v-if="!selectedMessages.length" class="chat-dialog-header-info">
                    <div v-if="activeDialog" :key="activeDialog.title" class="title">
                      {{ activeDialog.title }}
                    </div>
                    <div class="online">
                    </div>
                  </div>
                  <div key='2' v-else class="chat-dialog-header-panel">
                    <button class="chat-btn">
                      Переслать
                    </button>
                    <button @click="answerMessage" class="chat-btn">
                      Ответить
                    </button>
                    <button @click="removeMessage" class="chat-btn">
                      Удалить
                    </button>
                  </div>
                </transition>
              </div>
            </div>
            <div :class="[chat.answering ? 'paddingAnswering' : '', activeDialog.newMessage.attachment.files.length ? 'paddingFiles' : '']" class="chat-dialog-content">
              <!-- v-if="activeDialog && activeDialog.messages.length" -->
              <div v-if="activeDialog && activeDialog.messages.length" class="chat-dialog-content-wrap">
                <div v-for="(item) in activeDialog.messages" class="chat-dialog-content-box">
                  <div class="date-row">
                    <div class="chat-dialog-content-date">{{ item.date }}</div>
                  </div>
                  <transition-group name="testanim" tag="div">
                    <message @click="chooseMessageOther(message)" @click-image="loadImageMessage" @dblclick="chooseMessage(message)" :choosedState="!!selectedMessages.length" :key="message.id" class="message" :data-message="message.id" :isYourselfMessage="isYourselfMessage(message)" :class="[isYourselfMessage(message) ? 'yourself' : 'companion', message.choosed ? 'choosed' : '']" v-for="(message, index) in item.messages" :message="message"/>
                  </transition-group>
                </div>
              </div>

            </div>
            <transition name="answer-field">
              <div v-if="chat.answering" class="chat-dialog-answer">
                <div class="chat-dialog-answer__icon">
                  <svg height="512px" id="Layer_1" style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="512px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <g><path fill="currentColor" d="M288,298.1v92.3L448,256L288,112v80C100.8,192,64,400,64,400C117,307,186.4,298.1,288,298.1z"/></g>
                  </svg>
                </div>
                <div class="chat-dialog-answer-content">
                  <div class="chat-dialog-answer-content__messages">
                    <p>
                      Cообщений:
                    </p>
                    <transition tag="div" class="emptyNumber" name="number-change">
                      <span :key="selectedMessages.length">
                        {{ selectedMessages.length }}
                      </span>
                    </transition>

                  </div>
                </div>
                <div @click="closeAnswering" class="chat-dialog-answer__close">
                  <svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14.1562 1.41L12.7463 0L7.15625 5.59L1.56625 0L0.15625 1.41L5.74625 7L0.15625 12.59L1.56625 14L7.15625 8.41L12.7463 14L14.1562 12.59L8.56625 7L14.1562 1.41Z" fill="currentColor"/>
                  </svg>
                </div>
              </div>
            </transition>
            <transition name="attachment-field">
              <div v-if="activeDialog.newMessage.attachment.files.length" class="chat-dialog-attachment">
                <div>
                  <div class="chat-dialog-attachment-wrap">
                    <div class="chat-dialog-attachment-list">
                      <div v-for="(file, index) in activeDialog.newMessage.attachment.files" :key="index" class="chat-dialog-attachment-list__file">
                        <div class="fileWrap">
                          <img v-if="file.type === 'image'" @click="openGalleryPopup" :src="file.src" alt="">
                          <video v-if="file.type === 'video'" @click="openGalleryPopup" :src="file.src" alt="">
                        </div>
                        <svg v-if="true" @click="removeAttachment({ file, index })" class="fileWrap__close" width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M14.1562 1.41L12.7463 0L7.15625 5.59L1.56625 0L0.15625 1.41L5.74625 7L0.15625 12.59L1.56625 14L7.15625 8.41L12.7463 14L14.1562 12.59L8.56625 7L14.1562 1.41Z" fill="currentColor"/>
                        </svg>
                      </div>
                    </div>
                  </div>
                  <div @click="closeAttachment" class="chat-dialog-attachment__close">
                    <svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M14.1562 1.41L12.7463 0L7.15625 5.59L1.56625 0L0.15625 1.41L5.74625 7L0.15625 12.59L1.56625 14L7.15625 8.41L12.7463 14L14.1562 12.59L8.56625 7L14.1562 1.41Z" fill="currentColor"/>
                    </svg>
                  </div>
                </div>
              </div>
            </transition>
            <div class="chat-dialog-field">
              <div class="chat-dialog-field-wrap">
                <div class="chat-dialog-field-attach">
                  <label>
                    <svg @click="openAttachment" fill="currentColor" height="800px" width="800px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                      viewBox="0 0 511.988 511.988" xml:space="preserve">
                      <g>
                        <g>
                          <path d="M459.1,37.48c-49.999-49.973-131.045-49.973-181.018,0L21.594,295.355c-8.309,8.354-8.272,21.861,0.081,30.17
                            c8.354,8.309,21.861,8.272,30.17-0.081L308.293,67.609c33.271-33.271,87.308-33.271,120.641,0.045
                            c33.328,33.328,33.328,87.359,0,120.67L164.912,453.755c-20.787,20.772-54.563,20.772-75.396-0.046
                            c-20.826-20.826-20.826-54.593,0.006-75.425l218.731-218.731c0.007-0.007,0.013-0.015,0.02-0.022
                            c8.332-8.309,21.816-8.303,30.139,0.02c8.33,8.33,8.33,21.831,0,30.161l-105.58,105.602c-8.33,8.332-8.329,21.84,0.003,30.17
                            c8.332,8.33,21.84,8.329,30.17-0.003l105.579-105.6c24.991-24.991,24.991-65.507-0.002-90.499
                            c-24.993-24.993-65.508-24.993-90.501,0c-0.014,0.014-0.026,0.03-0.04,0.044L59.352,348.115
                            c-37.494,37.494-37.494,98.276,0,135.77c37.498,37.471,98.272,37.471,135.764,0.006L459.14,218.458
                            C509.096,168.528,509.096,87.476,459.1,37.48z"/>
                        </g>
                      </g>
                    </svg>
                    <input multiple @change="loadAttachment" type="file" accept=".pdf, image/png, image/jpeg, video/*">
                  </label>

                  <!--// -<transition name="modal-open">
                  // -  <div v-if="chat.attachment.isShow" class="chat-dialog-field-attach-modal">
                  // -  </div>
                  // -</transition>-->
                </div>
                <div class="chat-dialog-field__input">
                  <textarea v-model="activeDialog.newMessage.text" @keyup.ctrl.enter="sendMessage" placeholder="Введите сообщение" name="" id=""></textarea>
                </div>
                <div class="chat-dialog-field__control">
                  <svg @click="sendMessage" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 14L12.2728 19.3032C12.5856 20.0331 13.5586 20.1103 13.9486 19.4185C14.7183 18.0535 15.8591 15.8522 17 13C19 8 20 4 20 4M10 14L4.69678 11.7272C3.96687 11.4144 3.88975 10.4414 4.58149 10.0514C5.94647 9.28173 8.14784 8.14086 11 7C16 5 20 4 20 4M10 14L20 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>
          <div v-else class="loading">
            <svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" viewBox="0 0 38 38">
              <defs>
                  <linearGradient x1="8.042%" y1="0%" x2="65.682%" y2="23.865%" id="a">
                      <stop stop-color="rgb(19, 94, 129)" stop-opacity="0" offset="0%"/>
                      <stop stop-color="rgb(19, 94, 129)" stop-opacity=".631" offset="63.146%"/>
                      <stop stop-color="rgb(19, 94, 129)" offset="100%"/>
                  </linearGradient>
              </defs>
              <g fill="none" fill-rule="evenodd">
                  <g transform="translate(1 1)">
                      <path d="M36 18c0-9.94-8.06-18-18-18" id="Oval-2" stroke="url(#a)" stroke-width="2">
                          <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.9s" repeatCount="indefinite"/>
                      </path>
                      <circle fill="rgb(19, 94, 129)" cx="36" cy="18" r="1">
                          <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.9s" repeatCount="indefinite"/>
                      </circle>
                  </g>
              </g>
            </svg>
          </div>
        </div>
      </div>
      <div class="portal">
        <div v-if="galleryPopup.isShow" class="popup">
          <div class="popup-wrap">
            <div class="popup-body">
              <vue-slick-carousel :class="imagesInNewMessage.length === 1 ? 'single-slide' : ''" v-bind="slickOptions" :arrows="true" :dots="true">
                <div v-for="(file, imageIndex) in imagesInNewMessage" :key="'c1_image_' + imageIndex">
                  <img v-if="file.type === 'image'" :src="file.src">
                  <video controls v-if="file.type === 'video'" :src="file.src" alt=""></video>
                </div>
              </vue-slick-carousel>
              <svg @click="hideGalleryPopup" class="popup-close" width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14.1562 1.41L12.7463 0L7.15625 5.59L1.56625 0L0.15625 1.41L5.74625 7L0.15625 12.59L1.56625 14L7.15625 8.41L12.7463 14L14.1562 12.59L8.56625 7L14.1562 1.41Z" fill="currentColor"/>
              </svg>
            </div>
          </div>
        </div>
        <div v-if="galleryPopupMessage.isShow" class="popup">
          <div class="popup-wrap">
            <div class="popup-body">
              <vue-slick-carousel ref="messageGallerySlick" :class="galleryPopupMessage.images === 1 ? 'single-slide' : ''" v-bind="slickOptions" :arrows="true" :dots="true">
                <div v-for="(image, imageIndex) in galleryPopupMessage.images" :key="'c1_image_' + imageIndex" class="slide-wrap">
                  <img v-if="image.type === 'image'" :src="image.src">
                  <video controls v-if="image.type === 'video'" :src="image.src" alt=""></video>
                </div>
              </vue-slick-carousel>
              <svg @click="hideImageGalleryMessage" class="popup-close" width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14.1562 1.41L12.7463 0L7.15625 5.59L1.56625 0L0.15625 1.41L5.74625 7L0.15625 12.59L1.56625 14L7.15625 8.41L12.7463 14L14.1562 12.59L8.56625 7L14.1562 1.41Z" fill="currentColor"/>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
  <link rel="stylesheet" href="css/fontawesome-free-5.15.4-web/css/chat.css?ver=1">
  <link rel="stylesheet" href="css/fontawesome-free-5.15.4-web/css/transition.css?ver=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vue-slick-carousel@1.0.6/dist/vue-slick-carousel-theme.min.css">
  <link rel="stylesheet" href="css/fontawesome-free-5.15.4-web/css/slick.css?ver=1">
  <script src="./js/vue2.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-slick-carousel@1.0.6/dist/vue-slick-carousel.umd.min.js"></script>
  <script src="https://unpkg.com/vue-masonry@0.11.3/dist/vue-masonry-plugin-window.js"></script>
  <script type="module" src="./js/chat.js"></script>

 </body>
</html>

